# Pasos para instalar libmraa y Open CV en RockPi 3A 2GB
# utilizando python 3.8
# instalado ubuntu server Focal 20.04 stable e instalando xfce4
# usando paquetes de echo debian stable buster main
# SoC RK3568
# se instala la libreria mraa para manipulacion de pines


# Primera Parte - Elementos iniciales

# update all libraries
sudo apt-get update -y && sudo apt-get upgrade -y

# agregar libreria
# Modificar achivo " /etc/apt/sources.list.d/apt-radxa-com.list " y agregar repositorio de [Radxa APT]

    deb http://apt.radxa.com/focal-stable/ focal main
    deb http://apt.radxa.com/focal-testing/ focal main
# con el comando:
    sudo nano /etc/apt/sources.list.d/apt-radxa-com.list

# update all libraries
sudo apt-get update -y && sudo apt-get upgrade -y

#install GUI for test opencv
sudo apt-get install -y xfce4 xubuntu-desktop

# install recomended packages
sudo apt-get install -y build-essential libmraa gcc git wget mlocate curl cheese dpkg cmake pkg-config ccache python2 python3 python3-pip python3-dev qt5-default libpng-dev libjpeg-dev libeigen3-dev ffmpeg libavcodec-dev libavformat-dev libswscale-dev libavresample-dev libgstreamer1.0-dev libgstreamermm-1.0-dev libgtk-3-dev libgtkglext1-dev libgtkglextmm-x11-1.2-dev apt-utils python3-setuptools python3-opencv python3-numpy virtualenv libxslt1-dev zlib1g zlib1g-dev libglib2.0-0 libsm6 libgl1-mesa-glx libprotobuf-dev

# upgrade pip
pip3 install --upgrade pip

#install numpy
pip3 install numpy

# Segunda Parte - mraa - libreria de manipulacion de pines
# update all libraries
sudo apt-get update -y && sudo apt-get upgrade -y

sudo apt-get install -y libmraa thonny

#Copia de ejemplos de codigos
sudo cp -av /usr/local/share/mraa/examples/ /home/rock/mraa-examples

# Verificacion de libreria
mraa-gpio list

# realizacion de pruebas de puertos
# importante senalar que estamos usando el usuario rock y para esta prueba debemos ser super usuario con el comando

sudo mraa-gpio set 40 1 // esto deberia encender un led conectado al pin
sudo mraa-gpio set 40 0 // esto deberia apagar un led conectado al pin

# si funciono estas pruebas, vamos a la interfaz grafica del rockpi, y vamos a la terminal y ejecutar thonny como super usuario

sudo thonny

#una vez abierto vamos a buscar los ejemplos en la carpeta "/home/rock/mraa-examples" donde vamos a abir el archivo gpio.py
#vamos a hacer la prueba de circuito y coloquemos play.




# Tercera Parte - Open CV
# download & install OpenBLAS

    cd ~
    wget -O openblas.zip https://github.com/xianyi/OpenBLAS/releases/download/v0.3.23/OpenBLAS-0.3.23.zip
    unzip openblas.zip
    cd OpenBLAS-0.3.23
    make
    # esperar un momento en que compila
    sudo make install

# descargar e instalar OpenCV version XX

    cd ~
    wget -O opencv.zip https://github.com/opencv/opencv/archive/refs/tags/4.8.0.zip
    unzip opencv.zip
    cd opencv
    make
    # esperar un momento en que compila
    sudo make install


